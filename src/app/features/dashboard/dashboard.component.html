<ion-header>
    <ion-toolbar color="primary">
        <ion-buttons slot="start">
            <ion-menu-button></ion-menu-button>
        </ion-buttons>
        <ion-title>SGT - Dashboard</ion-title>
        <ion-buttons slot="end">
            <ion-button (click)="goToProfile()">
                <ion-icon slot="icon-only" name="person-circle"></ion-icon>
            </ion-button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
    <div *ngIf="loading" class="loading-container">
        <ion-spinner name="crescent"></ion-spinner>
        <p>Cargando datos...</p>
    </div>

    <div *ngIf="!loading">
        <!-- Estadísticas -->
        <ion-grid>
            <ion-row>
                <ion-col size="6">
                    <ion-card class="stat-card">
                        <ion-card-content>
                            <ion-icon name="cube" class="stat-icon"></ion-icon>
                            <h2>{{ totalProducts }}</h2>
                            <p>Total Productos</p>
                        </ion-card-content>
                    </ion-card>
                </ion-col>
                <ion-col size="6">
                    <ion-card class="stat-card">
                        <ion-card-content>
                            <ion-card-content>
                                <div class="chart-container">
                                    <canvas #pieChartCanvas></canvas>
                                </div>
                            </ion-card-content>
                    </ion-card>

                    <!-- Búsqueda -->
                    <ion-searchbar [(ngModel)]="searchTerm" (ionInput)="filterProducts($event)"
                        placeholder="Buscar por nombre o código de barras" animated="true">
                    </ion-searchbar>

                    <!-- Lista de Productos -->
                    <ion-card>
                        <ion-card-header>
                            <ion-card-title>Productos Recientes</ion-card-title>
                        </ion-card-header>
                        <ion-card-content>
                            <ion-list *ngIf="filteredProducts.length > 0">
                                <ion-item *ngFor="let product of filteredProducts.slice(0, 10)"
                                    [class.low-stock]="isLowStock(product.quantity)">
                                    <ion-label>
                                        <h2>{{ product.name }}</h2>
                                        <p>{{ product.category }}</p>
                                    </ion-label>
                                    <ion-badge slot="end" [color]="isLowStock(product.quantity) ? 'danger' : 'primary'">
                                        {{ product.quantity }} unidades
                                    </ion-badge>
                                </ion-item>
                            </ion-list>

                            <div *ngIf="filteredProducts.length === 0" class="empty-state">
                                <p>No se encontraron productos</p>
                            </div>

                            <ion-button expand="block" (click)="goToManageProducts()" class="manage-button">
                                Ver Todos los Productos
                            </ion-button>
                        </ion-card-content>
                    </ion-card>
    </div>

    <!-- Botón flotante para añadir producto -->
    <ion-fab slot="fixed" vertical="bottom" horizontal="end">
        <ion-fab-button (click)="goToAddProduct()">
            <ion-icon name="add"></ion-icon>
        </ion-fab-button>
    </ion-fab>
</ion-content>